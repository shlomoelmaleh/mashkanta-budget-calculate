<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>××—×©×‘×•×Ÿ ×ª×§×¦×™×‘ ×¨×›×™×©×ª × ×›×¡</title>
  <!-- Google Font: Heebo (supports Hebrew) -->
  <link href="https://fonts.googleapis.com/css2?family=Heebo:wght@300;400;500;700&display=swap" rel="stylesheet">
  <style>
    :root{
      /* ×—×•×‘×” */
      --clr-req:#d00;
      --clr-primary:#0052cc;          /* ×›×—×•×œ ××•×“×’×© ×œ×›×¤×ª×•×¨×™× */
      --clr-primary-light:#3c7bff;   /* hover */
      --clr-bg:#f7f9fc;              /* ×¨×§×¢ ×›×œ×œ×™ ×¢×“×™×Ÿ */
      --clr-card:#ffffff;            /* ×¨×§×¢ ×›×¨×˜×™×¡ */
      --clr-border:#dfe3e8;          /* ×’×‘×•×œ ×¢×“×™×Ÿ */
      --radius:12px;
      --shadow:0 4px 12px rgba(0,0,0,.06);
    }

    /* ×‘×¡×™×¡ */
    *{box-sizing:border-box}
    body{
      margin:0 auto;
      max-width:900px;
      padding:1.5rem;
      font-family:"Heebo",Arial,Helvetica,sans-serif;
      background:var(--clr-bg);
      color:#1c1e21;
    }
    h1{text-align:center;font-weight:700;margin-top:0}
    h2{margin:0 0 1rem;font-weight:500;font-size:1.25rem;color:var(--clr-primary)}

    /* ×›×¨×˜×™×¡×™×•×ª */
    .card{
      background:var(--clr-card);
      border:1px solid var(--clr-border);
      border-radius:var(--radius);
      box-shadow:var(--shadow);
      padding:1.25rem 1.5rem;
      margin-block:1.5rem;
    }

    /* ×˜×•×¤×¡ */
    label{
      display:flex;
      flex-direction:column;
      gap:0.25rem;
      margin-bottom:1rem;
      font-size:.95rem;
    }
    input[type="text"],
    input[type="number"]{
      width:50%; max-width:400px;
      padding:.45rem .6rem;
      font-family:inherit;
      font-size:.95rem;
      border:1px solid var(--clr-border);
      border-radius:var(--radius);
      direction:ltr;
      text-align:left;
      background:#fafbff;
      transition:border .15s;
    }
    input:focus{
      outline:none;
      border-color:var(--clr-primary);
    }

    /* ×©×›×™×¨×•×ª â€“ ×”×¡×ª×¨/×”×¦×’ */
    #rentSection{margin-top:.5rem;border-top:1px dashed var(--clr-border);padding-top:1rem}

    /* ×›×¤×ª×•×¨ */
    .btn-primary{
      display:inline-block;
      padding:.6rem 2rem;
      font-size:1rem;
      font-weight:500;
      color:#fff;
      background:var(--clr-primary);
      border:none;
      border-radius:var(--radius);
      cursor:pointer;
      transition:background .2s,transform .1s;
    }
    .btn-primary:hover{background:var(--clr-primary-light)}
    .btn-primary:active{transform:scale(.97)}

    /* ×ª×•×¦××•×ª */
    output{font-weight:700}
    #results p{margin:.5rem 0}

    /* ×¨×¡×¤×•× ×¡×™×‘×™ */
    @media(min-width:600px){
      .grid-2{
        display:flex;
        flex-direction:column;
        gap:1rem 2rem;
      }
      label{margin-bottom:0.75rem}
    }
  
  /* Additional aesthetic improvements */
  body {
    background: linear-gradient(135deg, #f0f4f8, #d9e2ec);
  }
  .card {
    box-shadow: 0 8px 16px rgba(0,0,0,0.1);
    transition: transform 0.3s, box-shadow 0.3s;
  }
  .card:hover {
    transform: translateY(-5px);
    box-shadow: 0 12px 24px rgba(0,0,0,0.15);
  }
  input[type="text"], input[type="number"] {
    background-color: #fff;
    border: 1px solid #ccd0d5;
  }
  input[type="text"]:focus, input[type="number"]:focus {
    border-color: #007bff;
    box-shadow: 0 0 8px rgba(0, 123, 255, 0.3);
  }
  .btn-primary {
    background: linear-gradient(135deg, #007bff, #0056b3);
  }
  .btn-primary:hover {
    background: linear-gradient(135deg, #0069d9, #004085);
  }
  #results {
    background-color: #edf7ed;
    border-left: 5px solid #4caf50;
  }

    .card {
      max-width: 600px;
      margin-left: auto;
      margin-right: auto;
    }
    input[type="text"], input[type="number"] {
      width: 40%; 
      max-width: 250px;
      text-align: right;
    }
    
    .card {
      text-align: center;
    }
    label {
      align-items: center;
    }
    input[type="text"], input[type="number"] {
      text-align: right;
      margin: 0 auto;
    }
    h2 {
      text-align: center;
    }
    
    .req{color:var(--clr-req);font-weight:700}
    </style>
    
    
</head>
<body>
  <h1>××—×©×‘×•×Ÿ ×ª×§×¦×™×‘ ×¨×›×™×©×ª × ×›×¡</h1>

  <form id="calcForm" onsubmit="return false;">
    <section class="card">
      <h2>× ×ª×•× ×™ ×‘×¡×™×¡</h2>
      <div class="grid-2">

<label>×©× ×¤×¨×˜×™ ×•××©×¤×—×” (*) : <input type="text" id="fullName" required></label>
<label>××¡×¤×¨ ×˜×œ×¤×•×Ÿ (*) : <input type="text" id="phone" required></label>
<label>××™××™×™×œ (*) : <input type="text" id="email" required></label>

        <label>×”×•×Ÿ ×¢×¦××™ ×–××™×Ÿ (â‚ª): <input type="text" class="num" id="equity" required value="1,000,000" step="10000"></label>
        <label>××—×•×– ××™××•×Ÿ ××§×¡×™××œ×™ (%): <input type="text" class="num" id="ltv" value="75" step="0.1"></label>
        <label>×”×›× ×¡×” ×¤× ×•×™×” ×—×•×“×©×™×ª (â‚ª): <input type="text" class="num" id="netIncome" required step="100"></label>
        <label>×™×—×¡ ×”×—×–×¨/×”×›× ×¡×” ××•×ª×¨ (%): <input type="text" class="num" id="ratio" value="33" min="30" max="40" step="0.1"></label>
        <label>×’×™×œ ×œ×•×•×”: <input type="text" class="num" id="age" required></label>
        <label>×’×™×œ ×¤×¨×™×¡×” ××§×¡×™××œ×™: <input type="text" class="num" id="maxAge" value="85"></label>
        <label>×¨×™×‘×™×ª ×©× ×ª×™×ª ×××•×¦×¢×ª (%): <input type="text" class="decimal-num" id="interest" value="5.0" step="0.1"></label>
      </div>
    </section>

    
</div>
<!-- Toggle button for amortization schedule -->
<section class="card">
      <h2>× ×ª×•× ×™ ×©×›×™×¨×•×ª (××•×¤×¦×™×•× ×œ×™)</h2>
      <label style="flex-direction:row;align-items:center;gap:.5rem">
        <input type="checkbox" id="isRented"> ×”× ×›×¡ ×™×•×©×›×¨
      </label>
      <div id="rentSection" class="grid-2" style="display:none">
        <label>×ª×©×•××ª ×©×›×™×¨×•×ª ×©× ×ª×™×ª (%): <input type="text" class="decimal-num" id="yield" value="2.0" step="0.1"></label>
        <label>×©×™×¢×•×¨ ×”×›×¨×” ×‘×‘× ×§ ××“××™ ×©×›×™×¨×•×ª (%): <input type="text" class="num" id="rentRecog" value="80" step="1"></label>
      </div>
      <label>×ª×§×¨×ª ×”×•×¦××” ×—×•×“×©×™×ª × ×˜×• (â‚ª, ××•×¤×¦×™×•× ×œ×™): <input type="text" class="num" id="budgetCap" step="100"></label>
    </section>

    <section class="card">
      <h2>×”×•×¦××•×ª × ×œ×•×•×ª</h2>
      <div class="grid-2">
        <label>
  <span>××¡ ×¨×›×™×©×”:</span>
  <div>
    <label>
      <input type="radio" name="purchaseTaxMode" id="purchaseTaxModePercent" checked>
      ××—×•×– ××©×•×•×™ ×”× ×›×¡
    </label>
    <label style="margin-left:1em">
      <input type="radio" name="purchaseTaxMode" id="purchaseTaxModeFixed">
      ×¡×›×•× ×§×‘×•×¢
    </label>
  </div>
  <input
    type="number"
    id="purchaseTaxPercent"
    class="decimal-num"
    placeholder="××—×•×– (%)"
    min="0"
    step="0.1"
    style="margin-top:0.5em;"
    value="8.0"
  >
  <input type="text" 
    id="purchaseTaxFixed"
    placeholder="×¡×›×•× ×§×‘×•×¢ (×©×§×œ×™×)"
    
    
    style="margin-top:0.5em; display:none;"
    >
  <small class="form-text text-muted">
    ×× ×‘×—×¨×ª â€œ×¡×›×•× ×§×‘×•×¢â€, ×ª×•×›×œ ×œ×—×©×‘ ××•×ª×• ×‘Ö¾<a href="https://www.misim.gov.il/svsimurechisha/FrmSimuMurchav.aspx#nbb" target="_blank">××—×©×‘×•×Ÿ ×¨×©×•×ª ×”××™×¡×™×</a> ×•×œ×”×“×‘×™×§ ×›××Ÿ.
  </small>
</label>
        <label>×©×›×¨ ×˜×¨×—×ª ×¢×•"×“ (%): <input type="text" class="decimal-num" id="lawyerPct" value="1.0" step="0.1"></label>
        <label>×“××™ ×ª×™×•×•×š (%): <input type="text" class="decimal-num" id="brokerPct" value="2.0" step="0.1"></label>
        <label>××¢"× (%): <input type="text" class="num" id="vatPct" value="18" step="1"></label>
        <label>×©×›×¨ ×˜×¨×—×ª ×™×•×¢×¥ ××©×›× ×ª× (â‚ª): <input type="text" class="num" id="advisorFee" value="15,000" step="1000"></label>
        <label>×”×•×¦××•×ª ×©×•× ×•×ª × ×•×¡×¤×•×ª (â‚ª): <input type="text" class="num" id="otherFee" value="3,000" step="100"></label>
      </div>
    </section>

    <div style="text-align:center;margin-top:2rem">
      <button type="button" class="btn-primary" id="calculateBtn">×—×©×‘</button>
    </div>
  </form>





  
    <style>
      .result-box {
        display: inline-block;
        background-color: #fff;
        border: 1px solid #ccd0d5;
        border-radius: 8px;
        padding: 0.5rem 1rem;
        margin-top: 0.5rem;
        font-size: 1.1rem;
        font-weight: 700;
        min-width: 200px;
        text-align: center;
        box-shadow: 0 2px 6px rgba(0,0,0,0.1);
      }
      .result-item {
        margin-bottom: 1rem;
      }
    </style>
    <section id="results" class="card">
    
    <h2>×ª×•×¦××•×ª</h2>
    <div class="result-item"><p>×©×•×•×™ × ×›×¡ ××§×¡×™××œ×™:</p><div class="result-box"><output id="pMax">â€”</output> â‚ª</div></div>
    <div class="result-item"><p>×¡×›×•× ××©×›× ×ª×:</p><div class="result-box"><output id="loanAmt">â€”</output> â‚ª</div></div>
    <div class="result-item"><p>××—×•×– ××™××•×Ÿ ×‘×¤×•×¢×œ:</p><div class="result-box"><output id="actualLTV">â€”</output> %</div></div>
    <div class="result-item"><p>×”×—×–×¨ ×—×•×“×©×™ ××©×•×¢×¨:</p><div class="result-box"><output id="monthlyPay">â€”</output> â‚ª</div></div>
    <div class="result-item"><p>×”×›× ×¡×” ××©×›×™×¨×•×ª (×—×•×“×©×™×ª):</p><div class="result-box"><output id="rentIncome">â€”</output> â‚ª</div></div>
    <div class="result-item"><p>×ª×©×œ×•× ×—×•×“×©×™ ×‘×§×™×–×•×– ×“××™ ×©×›×™×¨×•×ª:</p><div class="result-box"><output id="netOut">â€”</output> â‚ª</div></div>
    <div class="result-item"><p>×¡×š ×”×”×•×¦××•×ª ×”× ×œ×•×•×ª:</p><div class="result-box"><output id="acqCosts">â€”</output> â‚ª</div></div>
  
</section>
<div style="text-align:center; margin:1em 0;">
  <button id="toggleAmortBtn" style="
    padding:0.5em 1em;
    font-size:1em;
    font-weight:600;
    border:none;
    border-radius:0.5em;
    background-color:#3498db;
    color:#fff;
    cursor:pointer;
    box-shadow:0 2px 4px rgba(0,0,0,0.2);
    font-family:Arial, sans-serif;
    transition:background-color 0.3s ease;
  ">
    ×”×¦×’ ×œ×•×— ×¡×™×œ×•×§×™×Ÿ â–¼
  </button>
</div>

<div id="amortContainer" style="display:none;"><section class="card" id="amortSection" 
>
  <h2>×œ×•×— ×¡×™×œ×•×§×™×Ÿ</h2>
  <div style="text-align:right;margin-bottom:1rem">
    <button type="button" class="btn-primary" id="csvBtn">ğŸ“¥ ×”×•×¨×“ ×§×•×‘×¥ CSV</button>
  </div>
  <div style="overflow-x:auto">
    <table id="amortTable" style="width:100%;border-collapse:collapse;text-align:center">
      <thead style="background:#eef;font-weight:600">
        <tr>
          <th>×—×•×“×©</th><th>×™×ª×¨×ª ×¤×ª×™×—×”</th><th>×ª×©×œ×•× ×—×•×“×©×™</th><th>×¨×™×‘×™×ª</th><th>×§×¨×Ÿ</th><th>×™×ª×¨×ª ×¡×’×™×¨×”</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>
  </div>
</section></div>


<!-- ***** â€SCRIPT ×”××§×•×¨×™ (×¢× ×©×™× ×•×™ ×œ×ª××™×›×” ×‘××¡×¤×¨×™× ×¢×©×¨×•× ×™×™×) ***** -->
<script>
// ---------- ×¤×•×¨××˜ ××¡×¤×¨ ×¢× ×¤×¡×™×§×™× ----------
const format = n => n.toLocaleString('en-US', {maximumFractionDigits:0});
const formatDecimal = n => n.toLocaleString('en-US', {minimumFractionDigits:1, maximumFractionDigits:1});

// ---------- ×§×œ×˜×™×: ×¤×•×¨××˜ + ×—×™×¦×™× ----------
document.querySelectorAll('.num').forEach(inp=>{
  const step = Number(inp.getAttribute('step')||1);
  const numeric = () => Number((inp.value||'').replace(/,/g,'')); // ××¡×™×¨ ×¤×¡×™×§×™×
  const display = v => inp.value = format(v);                    // ××•×¡×™×£ ×¤×¡×™×§×™×
  if (inp.value) display(numeric());
  inp.addEventListener('input', () => {
    const raw = numeric();
    if (!isNaN(raw)) display(raw);
  });
  inp.addEventListener('keydown', e=>{
    if (e.key==='ArrowUp'||e.key==='ArrowDown') {
      e.preventDefault();
      let v = numeric()||0;
      v += (e.key==='ArrowUp'?step:-step);
      if (v<0) v=0;
      display(v);
    }
  });
});

// ---------- ×§×œ×˜×™× ×¢×©×¨×•× ×™×™×: ×¤×•×¨××˜ + ×—×™×¦×™× ----------
document.querySelectorAll('.decimal-num').forEach(inp=>{
  const step = Number(inp.getAttribute('step')||0.1);
  
  // ×¤×•× ×§×¦×™×” ×œ× ×™×§×•×™ ×•×”××¨×” ×©×œ ×”×§×œ×˜ ×œ××¡×¤×¨
  const numeric = () => {
    // ×”×¡×¨ ×¤×¡×™×§×™× ××œ×¤×™×
    let val = (inp.value||'').replace(/,/g,'');
    // ×”×—×œ×£ ×¤×¡×™×§×™× ×‘× ×§×•×“×•×ª (×× ×”××©×ª××© ×”×§×œ×™×“ ×¤×¡×™×§ ×¢×©×¨×•× ×™)
    val = val.replace(/,/g, '.');
    return Number(val);
  };
  
  // ×¤×•× ×§×¦×™×” ×œ×”×¦×’×ª ×”×¢×¨×š ×”××¢×•×¦×‘
  const display = v => {
    // ×©××™×¨×” ×¢×œ ××™×§×•× ×”×¡××Ÿ ×‘××™×“×ª ×”××¤×©×¨
    const pos = inp.selectionStart;
    const oldLen = inp.value.length;
    
    inp.value = v.toLocaleString('en-US', {
      minimumFractionDigits: 1,
      maximumFractionDigits: 1
    });
    
    // ×”×—×–×¨×ª ×”×¡××Ÿ ×œ××™×§×•× ×”× ×›×•×Ÿ
    if (document.activeElement === inp) {
      const newLen = inp.value.length;
      const newPos = Math.max(0, pos + (newLen - oldLen));
      setTimeout(() => {
        inp.setSelectionRange(newPos, newPos);
      }, 0);
    }
  };
  
  // ×”×¦×’ ×¢×¨×š ×”×ª×—×œ×ª×™ ××¢×•×¦×‘ ×× ×™×©
  if (inp.value) {
    try {
      display(numeric());
    } catch(e) {
      inp.value = step.toLocaleString('en-US', {
        minimumFractionDigits: 1,
        maximumFractionDigits: 1
      });
    }
  }
  
  // ×˜×™×¤×•×œ ×‘×”×§×œ×“×ª ××¡×¤×¨×™× ×•× ×§×•×“×” ×¢×©×¨×•× ×™×ª
  inp.addEventListener('input', () => {
    // ×©××™×¨×” ×¢×œ ××™×§×•× ×”×¡××Ÿ
    const pos = inp.selectionStart;
    
    // × ×§×” ×¢×¨×š ×•××¤×©×¨ ×¨×§ ××¡×¤×¨×™×, × ×§×•×“×” ×¢×©×¨×•× ×™×ª, ×¤×¡×™×§×™×
    let val = inp.value.replace(/[^\d.,]/g, '');
    
    // ×”×—×œ×£ ×¤×¡×™×§ ×¢×©×¨×•× ×™ ×‘× ×§×•×“×”
    val = val.replace(/,/g, '.');
    
    // ×”×©××¨ ×¨×§ × ×§×•×“×” ×¢×©×¨×•× ×™×ª ××—×ª
    const dotParts = val.split('.');
    if (dotParts.length > 2) {
      val = dotParts[0] + '.' + dotParts.slice(1).join('');
    }
    
    // ×× ×™×© ×¢×¨×š ×ª×§×£, ×”×¦×’ ××•×ª×• ××¢×•×¦×‘
    const num = Number(val);
    if (!isNaN(num)) {
      inp.value = val; // ×©××•×¨ ×¢×œ ×”×¢×¨×š ×›×¤×™ ×©×”×•× ×‘×–××Ÿ ×”×¢×¨×™×›×”
    }
  });
  
  // ×¢×™×¦×•×‘ ×”×¢×¨×š ×‘×¢×ª ×™×¦×™××” ××”×©×“×”
  inp.addEventListener('blur', () => {
    const num = numeric();
    if (!isNaN(num)) {
      display(num);
    }
  });
  
  // ×˜×™×¤×•×œ ×‘×—×™×¦×™ ××§×œ×“×ª
  inp.addEventListener('keydown', e=>{
    if (e.key==='ArrowUp'||e.key==='ArrowDown') {
      e.preventDefault();
      let v = numeric()||0;
      v += (e.key==='ArrowUp'?step:-step);
      if (v<0) v=0;
      display(v);
    }
  });
});

const $ = id => document.getElementById(id);
const equity=$('equity'), ltv=$('ltv'), netInc=$('netIncome'), ratio=$('ratio');
const age=$('age'), maxAge=$('maxAge'), interest=$('interest');
const isRent=$('isRented'), rentSec=$('rentSection'), yieldF=$('yield'), rentRec=$('rentRecog');
const budgetCap=$('budgetCap');
lawyerPct=$('lawyerPct'), brokerPct=$('brokerPct'), vatPct=$('vatPct');
const advisorFee=$('advisorFee'), otherFee=$('otherFee');
const fullName=$('fullName'), phone=$('phone'), email=$('email');
const pMaxO=$('pMax'), loanO=$('loanAmt'), actualLTVO=$('actualLTV'), payO=$('monthlyPay'), rentO=$('rentIncome'), netO=$('netOut'), acqO=$('acqCosts');

isRent.addEventListener('change', ()=> rentSec.style.display = isRent.checked ? 'grid' : 'none');
$('calculateBtn').addEventListener('click', calculate);

function v(el){return Number(el.value.replace(/,/g,''))||0;}

function calculate(){
// ××™××•×ª ×©×“×•×ª ×—×•×‘×”
if(!fullName.value.trim() || !phone.value.trim() || !email.value.trim()){
  alert('× × ×œ××œ× ×©× ××œ×, ×˜×œ×¤×•×Ÿ ×•××™××™×™×œ ×œ×¤× ×™ ×”×—×™×©×•×‘');
  return;
}

  const E=v(equity), l=v(ltv)/100, inc=v(netInc), r=v(ratio)/100;
  const years=Math.min(30, Math.max(v(maxAge)-v(age),0));
  if(years<=0){alert('×ª×§×•×¤×ª ×”×”×œ×•×•××” ××™× ×” ×ª×§×™× ×”');return;}
  const rate=v(interest)/100, mRate=rate/12;
  const A=mRate/(1-Math.pow(1+mRate,-12*years));
  const rented=isRent.checked, yld=rented?v(yieldF)/100:0, recg=rented?v(rentRecog)/100:0, cap=v(budgetCap)||null;
  const law = v(lawyerPct)/100, bro = v(brokerPct)/100, vat = v(vatPct)/100;
  const isPercentMode = document.getElementById('purchaseTaxModePercent').checked;
  const purchaseTaxPct = parseFloat(document.getElementById('purchaseTaxPercent').value) || 0;
  const purchaseTaxFixedVal = parseFloat(document.getElementById('purchaseTaxFixed').value) || 0;
  const p = isPercentMode ? purchaseTaxPct/100 : 0;
  let fix = v(advisorFee) + v(otherFee) + (isPercentMode ? 0 : purchaseTaxFixedVal);
  const f = p + (law + bro)*(1 + vat);
  if(E<=fix){alert('×”×”×•×Ÿ ×”×¢×¦××™ ××™× ×• ××›×¡×” ×”×•×¦××•×ª ×§×‘×•×¢×•×ª');return;}
  const P_equity=(E-fix)/(1+f-l);
  const denom=A*(1+f)-(r*recg*yld/12), P_income=denom>0?(r*inc+A*(E-fix))/denom:Infinity;
  let P_budget=Infinity;
  if(cap){const dBud=A*(1+f)-(yld/12);P_budget=dBud>0?(cap+A*(E-fix))/dBud:Infinity;}
  const P_max=Math.max(0,Math.min(P_equity,P_income,P_budget));
  if(!isFinite(P_max)||P_max<=0){alert('××™×Ÿ ×¤×ª×¨×•×Ÿ ×¢× ×”× ×ª×•× ×™× ×©×”×•×–× ×•');return;}
  const acq=P_max*f+fix, loan=P_max*(1+f)-E+fix, pay=A*loan, rent=yld*P_max/12, net=pay-rent;
  
  // ×—×™×©×•×‘ ××—×•×– ×”××™××•×Ÿ ×‘×¤×•×¢×œ
  const actualLtv = (loan / P_max) * 100;
  
  pMaxO.textContent=format(P_max);
  loanO.textContent=format(loan);
  actualLTVO.textContent=formatDecimal(actualLtv); // ×¤×•×¨××˜ ×¢× ×¡×¤×¨×” ××—×ª ××—×¨×™ ×”× ×§×•×“×”
  payO.textContent=format(pay);
  rentO.textContent=format(rent);
  netO.textContent=format(net);
  acqO.textContent=format(acq);
}
</script>

<!-- ×œ×•×— ×¡×™×œ×•×§×™×Ÿ + CSV (Excel "sep=;" trick) -->
<script>
// ===== ×œ×•×— ×¡×™×œ×•×§×™×Ÿ + CSV (Excel "sep=;" trick) =====
function buildAmort(b,a,y){const m=a/12,n=y*12,p=(m===0)?b/n:b*m/(1-Math.pow(1+m,-n));const rows=[];let o=b;for(let i=1;i<=n&&o>0.01;i++){const r=o*m,c=p-r,cl=Math.max(0,o-c);rows.push([i,o,p,r,c,cl]);o=cl;}return rows;}
function populateAmort(rows){const tb=document.querySelector('#amortTable tbody');tb.innerHTML='';rows.forEach(r=>{const tr=document.createElement('tr');r.forEach(v=>{const td=document.createElement('td');td.textContent=Math.round(v).toLocaleString('en-US');tr.appendChild(td);});tb.appendChild(tr);});}
function exportCSV(){const header=['×—×•×“×©','×™×ª×¨×ª ×¤×ª×™×—×”','×ª×©×œ×•× ×—×•×“×©×™','×¨×™×‘×™×ª','×§×¨×Ÿ','×™×ª×¨×ª ×¡×’×™×¨×”'];const rows=[header];document.querySelectorAll('#amortTable tbody tr').forEach(tr=>{rows.push(Array.from(tr.children).map(td=>td.textContent.replace(/,/g,'')));});const csv=['sep=;'].concat(rows.map(r=>r.join(';'))).join('\n');const blob=new Blob(["\uFEFF"+csv],{type:'text/csv;charset=utf-8;'});const url=URL.createObjectURL(blob);const a=document.createElement('a');a.href=url;a.download='×œ×•×—_×¡×™×œ×•×§×™×Ÿ.csv';document.body.appendChild(a);a.click();document.body.removeChild(a);URL.revokeObjectURL(url);}
document.addEventListener('DOMContentLoaded',()=>{const res=document.getElementById('results'),amp=document.getElementById('amortContainer');if(res&&amp)res.insertAdjacentElement('afterend',amp);document.getElementById('csvBtn').addEventListener('click',exportCSV);const btn=document.getElementById('calculateBtn'),orig=window.calculate;function wrap(){orig();const loan=Number(document.getElementById('loanAmt').textContent.replace(/,/g,''))||0,rate=Number(document.getElementById('interest').value.replace(/,/g,''))/100||0,age=Number(document.getElementById('age').value.replace(/,/g,''))||0,max=Number(document.getElementById('maxAge').value.replace(/,/g,''))||85;let yrs=Math.min(30,Math.max(max-age,0));if(yrs===0)yrs=30;loan>0?populateAmort(buildAmort(loan,rate,yrs)):amp.style.display='none';}btn.removeEventListener('click',window.calculate);btn.addEventListener('click',wrap);window.calculate=wrap;});
</script>

<script>
function exportCSV(){
  const header = ['×—×•×“×©','×™×ª×¨×ª ×¤×ª×™×—×”','×ª×©×œ×•× ×—×•×“×©×™','×¨×™×‘×™×ª','×§×¨×Ÿ','×™×ª×¨×ª ×¡×’×™×¨×”'];
  const rows   = [header];
  document.querySelectorAll('#amortTable tbody tr').forEach(tr=>{
    rows.push(Array.from(tr.children).map(td=>td.textContent.replace(/,/g,'')));
  });
  const EOL = '\r\n';
  const csv = rows.map(r=>r.join(';')).join(EOL);
  const blob = new Blob(['\uFEFFsep=;'+EOL+csv], {type:'text/csv;charset=utf-8;'});
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a');
  a.href = url;
  a.download = '×œ×•×—_×¡×™×œ×•×§×™×Ÿ.csv';
  document.body.appendChild(a);
  a.click();
  document.body.removeChild(a);
  URL.revokeObjectURL(url);
}
</script>

<script>
function exportCSV(){
  const header = ['Month','Opening Balance','Monthly Payment','Interest','Principal','Closing Balance'];
  const rows   = [header];
  document.querySelectorAll('#amortTable tbody tr').forEach(tr=>{
    rows.push(Array.from(tr.children).map(td=>td.textContent.replace(/,/g,'')));
  });
  const EOL = '\r\n';
  const csv = rows.map(r=>r.join(';')).join(EOL);
  const blob = new Blob(['\uFEFFsep=;'+EOL+csv], {type:'text/csv;charset=utf-8;'});
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a');
  a.href = url;
  a.download = 'Amortization_Schedule.csv';
  document.body.appendChild(a);
  a.click();
  document.body.removeChild(a);
  URL.revokeObjectURL(url);
}
</script>


<script>
document.addEventListener('DOMContentLoaded', function() {
  document.querySelectorAll('input[name="purchaseTaxMode"]').forEach(function(el) {
    el.addEventListener('change', function() {
      var isPercent = document.getElementById('purchaseTaxModePercent').checked;
      document.getElementById('purchaseTaxPercent').style.display = isPercent ? 'block' : 'none';
      document.getElementById('purchaseTaxFixed').style.display = isPercent ? 'none' : 'block';
    });
  });
});
</script>


<script>
document.addEventListener('DOMContentLoaded', function() {
  var btn = document.getElementById('toggleAmortBtn');
  var container = document.getElementById('amortContainer');
  btn.addEventListener('click', function() {
    if (container.style.display === 'none') {
      container.style.display = 'block';
      btn.textContent = '×”×¡×ª×¨ ×œ×•×— ×¡×™×œ×•×§×™×Ÿ â–²';
    } else {
      container.style.display = 'none';
      btn.textContent = '×”×¦×’ ×œ×•×— ×¡×™×œ×•×§×™×Ÿ â–¼';
    }
  });
});
</script>

</body>
</html>